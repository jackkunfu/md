- 高性能 web 服务器要点
  - 事件驱动
    - 传统处理并发，一个用户连接新建一个进程，分配一定资源，更多用户需要增加服务器资源成本
      - 假设每个线程需要2MB的配置内存，因此相对一个8GB的服务器主机，也只能承受来自4000个并发用户的请求
    - 在Node.js中每个HTTP连接都会发射一个在Node.js引擎的进程中运行的事件，而不是为每个连接生成一个新的OS进程
      - 可以实现高并发，节省服务器资源
      - 主线程是单线程，不能充分利用多核Cpu资源来提升运行效率
        - pm2 负载均衡的Node应用的进程管理器.可以解决这个问题
          - pm2可以把你的应用部署到服务器所有的CPU上
            - pm2 start app.js -i max # 根据有效CPU数目启动最大进程数目
            - pm2 特点
              - 内建负载均衡（使用Node cluster 集群模块、子进程，可以参考朴灵的《深入浅出node.js》一书第九章）
              - 线程守护，keep alive
              - 0秒停机重载，维护升级的时候不需要停机.
              - 现在 Linux (stable) & MacOSx (stable) & Windows (stable).多平台支持
              - 停止不稳定的进程（避免无限循环）
              - 控制台检测
              - 提供 HTTP API
              - 远程控制和实时的接口API ( Nodejs 模块,允许和PM2进程管理器交互 )
            - -i 启动进程数(cpu核心数)
            - -x 用 fork 模式启动，不使用 cluster
              - fork
              - cluster
            - --name 启动进程命名

  - 非阻塞 I/O
    - 异步编程
      - 优点
        - 节约CPU资源、不阻塞、快速、高响应
        - 异步的编码范式几乎用不到锁
          - 锁?

- 运行 V8 JavaScript 引擎，性能非常好。
- 在单个进程中运行，无需为每个请求创建新的线程。
  - 使用单个服务器处理数千个并发连接，而​​不会引入管理线程并发的负担（线程管理并发可能是错误的重要来源）
  - Node.js 将在响应返回时恢复操作（而不是阻塞线程和浪费 CPU 周期等待）。