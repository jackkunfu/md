# 跨域

# JavaScript 同源策略的限制，脚本只能读取和所属文档来源相同的窗口和文档的属性。

## 代理 proxy - 服务端请求转发避免跨域问题

```
--------------- 开发 webpack-dev-server ----------:
devServer: {
  proxy: {
    '/api': {
      target: '',
      changeOrigin: true,
      pathRewrite: {
        '/api': ''
      }
    }
  }
}
----------------- 线上 nginx ----------------:
location /api {
  proxy_pass http://www.abc.com;
}
```

## window.name

```
iframe 中设置 window.name 数据值，iframe 重新加载或者跳转页面 window.name 数据仍然存在，外层父级页面可以获取到（同源的）
1.父级页面监听iframe的onload事件
2.iframe 设置 winddow.name 数据之后跳转到父级页面同源的页面（空白页面即可），供父级页面可以拿到同源的iframe 中的数据 iframe.contentWindow.name
3.一般使用一个隐藏的iframe
```

```
父级页面 a.com
{
  ifame.onload = () => {
    if (iframe.contentWindow.location.href.indexOf('a.com') > -1) {
      console.log(iframe.contentWindow.name)
    }
  }
}

iframe b.com
{
  window.name = JSON.stringify({a: 1}) // 设置好数据
  location.href = 'http://a.com/black.html' // 跳转到父级域名中的某个空白页面
}
```

## document.domain 设置跨域访问子域

```
具有相同document.domain的页面，就相当于是处在同域名的服务器上，如果协议和端口号也是一致，那它们之间就可以跨域访问数据。
默认情况下，document.domain存放的是载入文档的服务器的主机名，可以手动设置这个属性，不过是有限制的，只能设置成当前域名或者上级的域名, 通过设置成相同的上级域名实现跨域访问同域数据
```

```
id.qq.com 页面中打开控制台执行
{
  var w = window.open('www.qq.com')
  w.document // 报错 Uncaught DOMException: Blocked a frame with origin "https://id.qq.com" from accessing a cross-origin frame.
  document.domain = 'qq.com'
  w.document // 正常打印
}
```

## jsonp

```
script 可以加载不同源数据
```
